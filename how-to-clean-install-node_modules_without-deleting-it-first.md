When you&#39;re installing npm packages, chances are you&#39;ll have a pretty large node\_modules folder. For projects I&#39;ve worked on in the past, it&#39;s not uncommon that they will be 500MB or even 1.5GB+ in size. These folders contain many thousands of files, and in some cases nearly 100,000 files.

TL;DR:

- When you want to delete your node\_modules folder, rename it to node\_modules\_to\_delete\_\&lt;whatever\&gt;

- Add the line &quot;node\_modules\_to\_delete\*&quot; (without quotes) to .git/info/exclude

- Delete the node\_modules\_to\_delete folders some other time

In some cases you&#39;ll have to delete your node\_modules folder, for example, you&#39;re debugging a strange dependency issue, or you&#39;ve force-cancelled an installation half-way through and now your node\_modules folder is corrupted.

Deleting 100,000 files at once isn&#39;t that fun. It takes about three or four minutes (at least for me), even on an SSD. If you have to do this multiple times while you&#39;re debugging, that&#39;s easily 20min out the window, just waiting for a folder to delete.

Is there a faster way to delete this folder?

### Attempt 1

Instead of deleting the folder, what about renaming it? NPM just looks for the folder called node\_modules, so if it&#39;s called node\_modules2 it won&#39;t see it.

This works pretty well, and it&#39;s renamed instantly. NPM install creates a new node\_modules directory and we can repeat this process ad-infinitum, assuming we have enough space. Except it&#39;s really hard to manage hundreds of thousands of small files while you&#39;re trying to use Git.

Git will see this directory and slow down any commands you use to view the untracked files. This means that Visual Studio Code&#39;s Git integration will become useless, and you&#39;ll probably see a message like &quot;The git repository at &#39;c:\Users\yorke\Desktop\toh-pt6&#39; has too many active changes, only a subset of Git features will be enabled.&quot;

What if we move it outside of the folder? Well, it&#39;s the same speed as deleting it.

### Attempt 2

Ok, so we know that we can&#39;t move the folder. What if we redirected everything written to node\_modules somewhere else? We could then change the pointer to another directory whenever we want and don&#39;t have to move anything.

On Windows these are called junctions and symlinks. To spare you the troubleshooting, node\_modules doesn&#39;t work with junctions but they do with symlinks. Here&#39;s how you can set them up (run these commands in cmd.exe as an administrator):

- Create an empty dir at C:\Users\\&lt;username\&gt;\Documents\node\_modules

- Cd into your project directory

- Delete the node\_modules folder in your project directory

- Run mklink /d node\_modules C:\Users\\&lt;username\&gt;\Documents\node\_modules

Now you&#39;ll have a folder with a small arrow in the corner called node\_modules in your project directory. This will point to the directory in your documents folder.

When you want to delete your node\_modules, just rename the node\_modules folder in the Documents directory, then create a new directory in Documents called &quot;node\_modules&quot;. It&#39;s that easy.

This works pretty well, except we&#39;re accumulating a lot of node\_modules folders. At some point we will have to delete them, and it&#39;s going to take a while.

We could end it off here and make a scheduled task that runs on idle that deletes all of the old node\_modules folders. This works, it&#39;s a bit disorganized, and it&#39;ll still take a super long time to delete the folders but the impact is minimized. We can do a bit better though.

### Attempt 3

Formatting partitions is super fast, irregardless of how many files are on the disk. So, we can shrink our C drive by a few GBs, and make the symlink point to the node\_modules folder there.

If you want to blast away your node\_modules, just reformat the drive and just add an empty node\_modules folder back. This is _ultra_ fast, and potentially a good option if you have very very large complex node\_modules, need to delete it often, and have limited disk space.

While this is the fastest way in terms of pure deleted files per second speed, there is a hybrid option.

### Attempt 4, going full circle

Remember attempt 1, where I tried to rename the node\_modules folder but it clogged up Git? The only issue with that solution was that Git wanted to investigate all of those files and slowed down everything that used Git.

However, Git is able to use a .gitignore file, which can ignore directories. We can add a glob such as &quot;node\_modules\_to\_delete\*&quot; in our .gitignore file and it won&#39;t traverse the directory.

This works surprisingly well. The Git extension in Visual Studio Code loads for maybe a single second longer but doesn&#39;t try to investigate all of the files we&#39;re trying to throw away. We also don&#39;t get that warning message from earlier, and Git doesn&#39;t show those files in the untracked changes.

Success? Almost. If you work in a team, they probably don&#39;t want to see the &quot;node\_modules\_to\_delete\*&quot; in a team-wide .gitignore.

Git has another way to ignore files on a per-project basis using the .git/info/exclude file. This file isn&#39;t checked in, and it&#39;s just for your own personal use.

So, what we can do is add /node\_modules\_to\_delete\* to the .git/info/exclude file, relative to your project&#39;s directory. It&#39;s an invisible folder so you&#39;ll have to append /.git in Explorer to see it.

Whenever you want to delete your node\_modules, just rename it to node\_modules\_to\_delete\_whatever, and continue on with your day. While this still doesn&#39;t fix the inevitable node\_modules purge, it defers it to another time when you have spare IO cycles to deal with it, or make a scheduled task to delete them.

It&#39;d be easy to make a script which could rename the node\_modules directory to, say, node\_modules\_to\_delete\_current\_date (so that they wouldn&#39;t overlap with other to-be-deleted directories.)

### Conclusion

I&#39;ve outlined a fast way to delete your node\_modules folder by deferring deletion by moving it to a different directory, ignoring the deleted names locally, then deleting it at a later date.

If you want to optimize for ease of use:

- When you want to delete your node\_modules folder, rename it to node\_modules\_to\_delete\_\&lt;whatever\&gt;

- Add the line &quot;node\_modules\_to\_delete\*&quot; (without quotes) to .git/info/exclude

- Delete the node\_modules\_to\_delete folders some other time

If you have a few GBs to spare and want near-instant deletes:

- Create an empty dir called node\_modules in your partition

- Cd into your project directory

- Delete the node\_modules folder in your project directory

- Run mklink /d node\_modules /path/to/node\_modules/at/partition as an administrator

- Reformat the partition whenever you want
